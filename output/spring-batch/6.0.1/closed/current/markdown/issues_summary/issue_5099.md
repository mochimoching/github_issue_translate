*(このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました)*

## 課題概要

新しいチャンク処理の実装（Spring Batch 6.0/Spring Boot 4.0で導入）において、ローカルパーティショニングを使用したステップの処理が早期に終了してしまうバグです。

**現象**:
- パーティションごとに処理するアイテム数が異なる場合
- 最初のパーティションが完了した時点で、他のパーティションの処理が残っていてもステップ全体が終了してしまう

**構造の理解**:
- **パーティショニング**: 1つの大きなジョブを複数の小さな「パーティション」に分割し、並列処理する機能
- **ChunkOrientedStep**: データを一定の塊（チャンク）ごとに読み込み・処理・書き込みを行うステップ実装
- **ChunkTracker**: チャンク処理の進捗や終了判定を管理するコンポーネント

## 原因

`ChunkTracker`のインスタンス管理スコープに誤りがありました。
- 現状: ステップ全体で1つのインスタンス（またはスレッドローカルの管理が不適切）が共有されている可能性があります
- 問題: あるパーティションで「アイテム無し（処理完了）」と判定されると、その状態が共有され、まだ処理中の他のパーティションも終了とみなされてしまいます

特に、`ChunkOrientedStep`が各パーティションスレッドで実行される際、終了状態のフラグ管理が適切に分離されていないことが原因です。

## 対応方針

`ChunkTracker`のライフサイクル管理を修正し、各パーティション実行（スレッド）ごとに独立して状態を管理できるようにします。

- スレッドバウンドな`ChunkTracker`の実装を修正
- `threadLocal.remove()`等を使用して、実行ごとのクリーンアップを確実に行う
