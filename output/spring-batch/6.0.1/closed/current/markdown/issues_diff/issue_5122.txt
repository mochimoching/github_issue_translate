Issue #5122: `MapJobRegistry` registers discovered Jobs by their bean name instead of their job name
Reference: Commit 184ac31 (2025-12-05T05:51:21Z)
URL: https://github.com/spring-projects/spring-batch/commit/184ac31f704935c6d49865839713cd3126ce7cd3

--- Diff ---
diff --git a/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/support/MapJobRegistry.java b/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/support/MapJobRegistry.java
index 4071860a24..2975701db1 100644
--- a/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/support/MapJobRegistry.java
+++ b/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/support/MapJobRegistry.java
@@ -1,5 +1,5 @@
 /*
- * Copyright 2006-2025 the original author or authors.
+ * Copyright 2006-present the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -63,7 +63,14 @@ public void setApplicationContext(ApplicationContext applicationContext) throws
 	@Override
 	public void afterSingletonsInstantiated() {
 		Map<String, Job> jobBeans = this.applicationContext.getBeansOfType(Job.class);
-		this.map.putAll(jobBeans);
+		for (Job job : jobBeans.values()) {
+			try {
+				register(job);
+			}
+			catch (DuplicateJobException e) {
+				throw new IllegalStateException("Unable to register job " + job.getName(), e);
+			}
+		}
 	}
 
 	@Override
diff --git a/spring-batch-core/src/test/java/org/springframework/batch/core/configuration/support/JobRegistryIntegrationTests.java b/spring-batch-core/src/test/java/org/springframework/batch/core/configuration/support/JobRegistryIntegrationTests.java
index 4b6d853d07..0888f3c974 100644
--- a/spring-batch-core/src/test/java/org/springframework/batch/core/configuration/support/JobRegistryIntegrationTests.java
+++ b/spring-batch-core/src/test/java/org/springframework/batch/core/configuration/support/JobRegistryIntegrationTests.java
@@ -16,14 +16,24 @@
 package org.springframework.batch.core.configuration.support;
 
 import static org.junit.jupiter.api.Assertions.assertEquals;
+import static org.junit.jupiter.api.Assertions.assertThrows;
 
+import org.junit.jupiter.api.Assertions;
 import org.junit.jupiter.api.Test;
+import org.junit.jupiter.api.function.Executable;
 
 import org.springframework.batch.core.configuration.DuplicateJobException;
-import org.springframework.batch.core.job.Job;
+import org.springframework.batch.core.configuration.annotation.EnableBatchProcessing;
+import org.springframework.batch.core.job.*;
 import org.springframework.batch.core.configuration.JobRegistry;
-import org.springframework.batch.core.job.SimpleJob;
+import org.springframework.batch.core.job.builder.JobBuilder;
+import org.springframework.batch.core.repository.JobRepository;
+import org.springframework.batch.core.step.StepSupport;
 import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.context.ApplicationContext;
+import org.springframework.context.annotation.AnnotationConfigApplicationContext;
+import org.springframework.context.annotation.Bean;
+import org.springframework.context.annotation.Configuration;
 import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;
 
 /**
@@ -44,4 +54,31 @@ void testRegistry() throws DuplicateJobException {
 		assertEquals(job.getName(), jobRegistry.getJobNames().iterator().next());
 	}
 
+	@Test
+	void testDuplicateJobRegistration() {
+		assertThrows(IllegalStateException.class,
+				() -> new AnnotationConfigApplicationContext(JobConfigurationWithDuplicateJobs.class));
+	}
+
+	@Configuration
+	@EnableBatchProcessing
+	static class JobConfigurationWithDuplicateJobs {
+
+		@Bean
+		Job job1() {
+			return new JobSupport("sameJobNameOnPurpose");
+		}
+
+		@Bean
+		Job job2() {
+			return new JobSupport("sameJobNameOnPurpose");
+		}
+
+		@Bean
+		public JobRegistry jobRegistry() {
+			return new MapJobRegistry();
+		}
+
+	}
+
 }
