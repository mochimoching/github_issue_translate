*このドキュメントは生成AI(Claude Sonnet 4.5)によって2025年12月31日に生成されました。*

# `.getUniqueJobParameters()`におけるパラメータキーの衝突の可能性

**Issue番号**: #5088

**状態**: closed | **作成者**: PENEKhun | **作成日**: 2025-11-16

**ラベル**: in: documentation, in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-batch/issues/5088

## 内容

**期待される動作**

<!--- どのように動作すべきか教えてください。機能がどうあるべきかを説明するコード例を追加してください。これはオプションですが、あなたの期待を理解するのに役立ちます。 -->

`getUniqueJobParameters()`によって生成されるジョブパラメータに使用されるキーは、ユーザーのジョブで定義されているパラメータ名と決して衝突してはいけません。ユーザーは`getUniqueJobParametersBuilder()`を呼び出し、フレームワークが生成したユニークパラメータを上書きするリスクなしに、任意のパラメータ名を自由に追加できるべきです。

**現在の動作**

現在、`getUniqueJobParameters()`はハードコードされた`"random"`キーを使用しています。

```java
public JobParameters getUniqueJobParameters() {
    return new JobParameters(Set.of(
        new JobParameter<>("random", this.secureRandom.nextLong(), Long.class)
    ));
}
```

これにより、以下のような衝突リスクが生じます:

```java
JobParameters params = jobOperatorTestUtils.getUniqueJobParametersBuilder()
    .addLong("random", 12345L)  // ユニークパラメータを上書き!
    .toJobParameters();
```

現在の動作では、ユーザーのジョブが既に`"random"`という名前のパラメータを定義している場合、`getUniqueJobParametersBuilder()`を安全に使用することが不可能になります。この場合、ユーザー提供の`"random"`パラメータがフレームワーク生成のものを上書きし、意図しない衝突を引き起こします。

**コンテキスト**

<!--- 
このissueはあなたにどのような影響を与えましたか?
何を達成しようとしていますか?
他にどのような代替案を検討しましたか?
回避策はありますか?
-->

- Q: 他にどのような代替案を検討しましたか?
  - 1. **名前空間付きキーを使用** (例: `spring.batch.test.unique`)、`random`キーの代わりに。
  - 2. **キーとしてのUUID + 説明的な値** (例: `{UUID="Auto-generated by Spring Batch Test for unique job parameters"}`)






## コメント

### コメント 1 by fmbenhassine

**作成日**: 2025-11-17

> `getUniqueJobParameters()`によって生成されるジョブパラメータに使用されるキーは、ユーザーのジョブで定義されているパラメータ名と決して衝突してはいけません。

逆です: ユーザー定義のパラメータ名は、フレームワークが提供するものと決して衝突してはいけません。`getUniqueJobParameters`メソッドは、ランダムな数値を追加することを述べていますが、パラメータ名(これは`random`)を指定していません。2つのこと:

- フレームワークが提供するパラメータは、`batch.`のプレフィックスを付けるべきです(実行コンテキスト属性と同様)
- `getUniqueJobParameters`メソッドは、`random`パラメータに`batch.`プレフィックスを追加し、それをJavadocで明確に言及するように更新すべきです。

### コメント 2 by PENEKhun

**作成日**: 2025-11-17

> > `getUniqueJobParameters()`によって生成されるジョブパラメータに使用されるキーは、ユーザーのジョブで定義されているパラメータ名と決して衝突してはいけません。
> 
> 逆です: ユーザー定義のパラメータ名は、フレームワークが提供するものと決して衝突してはいけません。`getUniqueJobParameters`メソッドは、ランダムな数値を追加することを述べていますが、パラメータ名(これは`random`)を指定していません。2つのこと:
> 
> * フレームワークが提供するパラメータは、`batch.`のプレフィックスを付けるべきです(実行コンテキスト属性と同様)
> * `getUniqueJobParameters`メソッドは、`random`パラメータに`batch.`プレフィックスを追加し、それをJavadocで明確に言及するように更新すべきです。

https://github.com/spring-projects/spring-batch/pull/5089 で適用しました。ありがとうございます!

### コメント 3 by fmbenhassine

**作成日**: 2025-11-18

#5089で解決しました。貢献をありがとうございます 🙏


