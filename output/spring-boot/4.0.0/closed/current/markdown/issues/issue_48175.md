# Change tomcat and jetty runtime modules to starters

**IssueÁï™Âè∑**: #48175

**Áä∂ÊÖã**: closed | **‰ΩúÊàêËÄÖ**: vpavic | **‰ΩúÊàêÊó•**: 2025-11-18

**„É©„Éô„É´**: type: enhancement

**URL**: https://github.com/spring-projects/spring-boot/issues/48175

**Èñ¢ÈÄ£„É™„É≥„ÇØ**:
- Commits:
  - [2685f4b](https://github.com/spring-projects/spring-boot/commit/2685f4bf2917f467a14eaf5a8c9a8e08b45dcfe1)

## ÂÜÖÂÆπ

https://github.com/spring-projects/spring-boot/issues/46944 and https://github.com/spring-projects/spring-boot/commit/635e766aaf4c3e47e4884daa96fbefffced91bff introduced some changes that are, in my opinion, negating some of the benefits of the modularization and are a step in wrong direction.

Prior to that commit, `spring-boot-tomcat` would only pull in the necessary Tomcat dependencies (`tomcat-embed-core`) but now it also pulls in `tomcat-embed-el` and `tomcat-embed-websocket` that are not needed by many applications. This goes against some of the [promises of modularization](https://spring.io/blog/2025/10/28/modularizing-spring-boot#why-modularize-the-codebase).

Additionally, _runtime_ modules introduced by that commit are in reality starter modules (as they hold no actual code) pretending to be actual modules. This sets a bad precedent, as it raises questions about what qualifies as a module vs a starter.

I didn't review the full codebase to whether there are other occurrences of this pattern, but my expectation around modules would be that they:

- hold code that integrates given technology in Spring Boot
- transitively pull in only minimal dependencies using appropriate dependency configuration while declaring non-essential ones as optional
- are combined with other dependencies (based on some opinion) in starters

I understand the goal of the https://github.com/spring-projects/spring-boot/issues/46944 was to make WAR deployments easier, but it shouldn't be done at the expense of other use cases. Did you perhaps consider having dedicated starters that hold opinion about WAR deployments?

I focused only on `spring-boot-tomcat` in this issue, but analogous concerns apply to `spring-boot-jetty`.

## „Ç≥„É°„É≥„Éà

### „Ç≥„É°„É≥„Éà 1 by philwebb

**‰ΩúÊàêÊó•**: 2025-11-20

Thanks for raising this @vpavic. It's been pretty hard to find an arrangement that works for all users and all build systems.

We discussed this issue this morning on our team call and were going to roll-back the change, but I think I've found another way to make it work by making the runtime modules starters. I've tested this setup manually using https://github.com/philwebb/gh-46944 and it appears to work.

The rest of the team will probably want to review this before we release 4.0.0, but ü§û this works and also solves your concerns. 

### „Ç≥„É°„É≥„Éà 2 by vpavic

**‰ΩúÊàêÊó•**: 2025-11-20

Thanks for taking this feedback into account, especially at such a late stage. Your changes from 2685f4b look like the arrangement I had hoped to have.

### „Ç≥„É°„É≥„Éà 3 by wilkinsona

**‰ΩúÊàêÊó•**: 2025-11-20

The error infrastructure is missing when deployed to a container:

```
   ErrorMvcAutoConfiguration:
      Did not match:
         - @ConditionalOnClass did not find required class 'org.springframework.boot.web.server.autoconfigure.ServerProperties' (OnClassCondition)
```

### „Ç≥„É°„É≥„Éà 4 by wilkinsona

**‰ΩúÊàêÊó•**: 2025-11-20

https://github.com/spring-projects/spring-boot/issues/48201 fixes the problem with the missing error infrastructure, not by changing how things are packaged in an uber war but by removing a dependency on `spring-boot-web-server` and `ServerProperties` from `ErrorMvcAutoConfigruation`.

There remains a small difference in what's in `WEB-INF/lib-provided`:

```
 unzip -l gh-46944-tomcat-maven/target/gh-46944-tomcat-maven-0.0.1-SNAPSHOT.war| grep WEB-INF/lib-provided | sort
        0  11-20-2025 11:16   WEB-INF/lib-provided/
   122023  02-01-1980 00:00   WEB-INF/lib-provided/spring-boot-tomcat-4.0.0-SNAPSHOT.jar
   174087  02-01-1980 00:00   WEB-INF/lib-provided/spring-boot-web-server-4.0.0-SNAPSHOT.jar
   270004  11-05-2025 19:03   WEB-INF/lib-provided/tomcat-embed-el-11.0.14.jar
   286284  11-05-2025 19:03   WEB-INF/lib-provided/tomcat-embed-websocket-11.0.14.jar
  3579737  11-05-2025 19:03   WEB-INF/lib-provided/tomcat-embed-core-11.0.14.jar
```

```
 unzip -l gh-46944-tomcat-gradle/build/libs/gh-46944-tomcat-gradle-0.0.1-SNAPSHOT.war| grep WEB-INF/lib-provided | sort
        0  02-01-1980 00:00   WEB-INF/lib-provided/
    26378  02-01-1980 00:00   WEB-INF/lib-provided/jakarta.annotation-api-3.0.0.jar
   122023  02-01-1980 00:00   WEB-INF/lib-provided/spring-boot-tomcat-4.0.0-SNAPSHOT.jar
   174087  02-01-1980 00:00   WEB-INF/lib-provided/spring-boot-web-server-4.0.0-SNAPSHOT.jar
   270004  02-01-1980 00:00   WEB-INF/lib-provided/tomcat-embed-el-11.0.14.jar
   286284  02-01-1980 00:00   WEB-INF/lib-provided/tomcat-embed-websocket-11.0.14.jar
  3579737  02-01-1980 00:00   WEB-INF/lib-provided/tomcat-embed-core-11.0.14.jar
```

Ideally, `jakarta.annotation-api-3.0.0.jar` would be in `WEB-INF/lib-provided` as it will be provided by the servlet container but I think what we have is good enough for now at least.

