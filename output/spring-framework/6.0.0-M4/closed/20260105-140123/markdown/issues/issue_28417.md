# Add Throwable functional interfaces

**Issue番号**: #28417

**状態**: closed | **作成者**: philwebb | **作成日**: 2022-05-05

**ラベル**: in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/28417

**関連リンク**:
- Commits:
  - [d205b8b](https://github.com/spring-projects/spring-framework/commit/d205b8b78ae14842d7a95966dbf85cec9b769e5b)
  - [37a2b3a](https://github.com/spring-projects/spring-framework/commit/37a2b3ab02724293197285145f11c669e5fef94f)
  - [b3efdf3](https://github.com/spring-projects/spring-framework/commit/b3efdf3c2b5b55624164d184d237795be6e7b3b5)

## 内容

Within the framework and portfolio projects we often need to deal with checked exceptions inside the body of a `Function`, `Supplier`, `Consumer`, etc. This usually involves writing `try`/`catch` blocks inside the body. Since exception handling is usually also handled by the framework, it would be nice if we could offer `Throwing...` versions of common functional interfaces that do the wrapping for us.

## コメント

### コメント 1 by quaff

**作成日**: 2022-05-05

Please consider throwing generic exception like this
```java
@FunctionalInterface
public interface CheckedFunction<T, R, E extends Throwable> {

	R apply(T t) throws E;

}
```

### コメント 2 by sbrannen

**作成日**: 2022-05-05

@quaff, can you please expound on your proposal with a rationale for needing the generic type declaration for the exception?

### コメント 3 by sbrannen

**作成日**: 2022-05-05

> it would be nice if we could offer `Throwing...` versions of common functional interfaces that do the wrapping for us.

I agree: such types can be very useful.

I also agree with the `Throwing*` naming convention. Though I noticed you've introduced `Throwable*` types in your commit.

I think we should go with `Throwing*`. For example, `ThrowableSupplier` implies that the supplier supplies a `Throwable`, like a `StringSupplier` would supply a `String`. 

Furthermore, the `Supplier` itself is not "throwable" since it does not implement `Throwable`.

What we're really talking about is a "supplier that is capable of throwing a checked exception", but we cannot convert that to a type name because it's simply too long: `CheckedExceptionThrowingSupplier`. If we go with `ThrowingSupplier`, that's succinct and in line with the naming convention used in several other open source projects -- for example, Spring Data, JUnit, AssertJ, Kotlin internals, [some JDK internals](https://twitter.com/sam_brannen/status/1431250271523459078), [etc.](https://www.google.com/search?q=%22ThrowingSupplier%22).




### コメント 4 by quaff

**作成日**: 2022-05-06

> @quaff, can you please expound on your proposal with a rationale for needing the generic type declaration for the exception?

@sbrannen  For example we can throw Throwable inside lambda
```java
@Aspect
public class Instrumentation {

	@Around("execution(* *.*(..))")
	public Object timing(ProceedingJoinPoint pjp) throws Throwable {
		return Tracing.execute(pjp, ProceedingJoinPoint::proceed);
	}
}
```
```java
public class Tracing {
	public static <T, R> R execute(T input, CheckedFunction<T, R, Throwable> function) throws Throwable {
		// create new span
		try {
			return function.apply(input);
		} finally {
			// finish span
		}
	}
}

```

### コメント 5 by quaff

**作成日**: 2022-05-06

> some JDK internals

Many projects use `Checked*`, for example `vavr` `elasticsearch`

### コメント 6 by sbrannen

**作成日**: 2022-05-06

> @sbrannen For example we can throw Throwable inside lambda

The Spring Framework typically tries to avoid throwing `Throwable` because that makes error handling more complex, and we don't want to have to catch `Throwable` and then decide if the exception should really be swallowed/handled/rethrown (e.g., OOME).

The commit Phil pushed declares `Exception` in the `throws` clauses in order to allow lambdas to throw unchecked and checked `Exception` types, and I think that is adequate for the needs of the framework.

> Many projects use `Checked*`, for example `vavr` `elasticsearch`

Indeed, that would be another option, but we've gone with `Throwing*`.

