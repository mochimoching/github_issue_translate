# Determine why previous isolation level is never set in R2dbcTransactionManager

**Issue番号**: #28202

**状態**: closed | **作成者**: sbrannen | **作成日**: 2022-03-20

**ラベル**: in: data, type: task

**URL**: https://github.com/spring-projects/spring-framework/issues/28202

**関連リンク**:
- Commits:
  - [fae36e9](https://github.com/spring-projects/spring-framework/commit/fae36e98b4c3d72941e3f209a87047332ff51ba1)

## 内容

## Overview

Currently, the `previousIsolationLevel` is never set in `R2dbcTransactionManager.ConnectionFactoryTransactionObject`; however, there is code in place to read the previous isolation level in `R2dbcTransactionManager.doCleanupAfterCompletion(TransactionSynchronizationManager, Object)`.

## Deliverables

- [x] Determine why `previousIsolationLevel` is never set.
- [x] Introduce code to set the `previousIsolationLevel` if appropriate; otherwise, delete all code related to `previousIsolationLevel`.

## コメント

### コメント 1 by sbrannen

**作成日**: 2022-03-20

@mp911de, can you please take a look at this?

### コメント 2 by mp911de

**作成日**: 2022-03-21

`previousIsolationLevel` should have been removed with the R2DBC 0.9 upgrade, it's an oversight.

Before R2DBC 0.9, we set and reset the Isolation Level on the connection (same as with JDBC). With R2DBC 0.9, if we set the Isolation Level, then the isolation level is only valid for the duration of a transaction and we expect the driver to reset the Isolation Level after the transaction. This is part of the `begin(TransactionDefinition)` contract.

### コメント 3 by sbrannen

**作成日**: 2022-03-21

Thanks for the feedback and explanation, @mp911de.

I'll remove the obsolete code.

