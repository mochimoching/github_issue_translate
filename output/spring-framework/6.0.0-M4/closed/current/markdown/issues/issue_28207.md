# Introduce predicate for searching enclosing classes in MergedAnnotations

**Issue番号**: #28207

**状態**: closed | **作成者**: sbrannen | **作成日**: 2022-03-21

**ラベル**: in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/28207

**関連リンク**:
- Commits:
  - [c23edf7](https://github.com/spring-projects/spring-framework/commit/c23edf7da6c403eeedb862e02b9a7293cfba38a1)
  - [1fe394f](https://github.com/spring-projects/spring-framework/commit/1fe394f11d7ab7f328402a04d13f4d12a89a9f87)
  - [23d0240](https://github.com/spring-projects/spring-framework/commit/23d0240dc724ddeacba5b5e84ce5c5f08e5d3dc3)

## 内容

## Overview

Due to the deprecation of `SearchStrategy.TYPE_HIERARCHY_AND_ENCLOSING_CLASSES` (see #28079), we will introduce a way for users to provide a `Predicate<Class<?>>` that is used to decide when the enclosing class for the class supplied to the predicate should be searched.

This will give the user complete control over the "enclosing classes" aspect of the search algorithm in `MergedAnnotations`.

- To achieve the same behavior as `TYPE_HIERARCHY_AND_ENCLOSING_CLASSES`, a user can provide `clazz -> true` as the predicate.
- To limit the enclosing class search to inner classes, a user can provide `ClassUtils::isInnerClass` as the predicate.
- To limit the enclosing class search to static nested classes, a user can provide `ClassUtils::isStaticClass` as the predicate.
- For any other use case (such as in `TestContextAnnotationUtils` in `spring-test`), the user can provide a custom predicate.

## Proposal

Based on the outcome of #28208, a `searchEnclosingClass` predicate could be supplied when using the `TYPE_HIERARCHY` search strategy as follows.

```java
MergedAnnotations annotations = MergedAnnotations
    .search(SearchStrategy.TYPE_HIERARCHY)
    .withEnclosingClasses(ClassUtils::isInnerClass)
    .from(myClass);
```

By limiting when a `searchEnclosingClass` predicate can be supplied in the fluent search API, we can prevent users from trying to supply such a predicate for other `SearchStrategy` types.

## コメント

### コメント 1 by sbrannen

**作成日**: 2022-03-21

Blocked until #28208 is implemented

