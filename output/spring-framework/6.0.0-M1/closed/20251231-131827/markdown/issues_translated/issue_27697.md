# HttpMethodをenumからclassにリファクタリング

**Issue番号**: [#27697](https://github.com/spring-projects/spring-framework/issues/27697)

**状態**: closed | **作成者**: poutsma | **作成日**: 2021-11-18

**ラベル**: in: web, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/27697

**関連リンク**:
- Commits:
  - [d075b43](https://github.com/spring-projects/spring-framework/commit/d075b43412ed86053249a6b82c879bf9f9820084)
  - [df0118d](https://github.com/spring-projects/spring-framework/commit/df0118d097c1692b08b6670542af441aebeb4250)
  - [47041ef](https://github.com/spring-projects/spring-framework/commit/47041ef407fff323c6fabd2511e2e0a3aa719273)
  - [b15b13a](https://github.com/spring-projects/spring-framework/commit/b15b13a68033e00aef52df28d70503e78a7723fb)
  - [5955253](https://github.com/spring-projects/spring-framework/commit/59552533402941d3ec81237e67be387c970cad4f)
  - [c710ada](https://github.com/spring-projects/spring-framework/commit/c710ada6ecfb49071ce5e27b432e885d748443b7)
  - [bc76dea](https://github.com/spring-projects/spring-framework/commit/bc76dea25a05b9ed821416dca401a943cc71035b)
  - [6623b31](https://github.com/spring-projects/spring-framework/commit/6623b31c2197b3a9c1c6fa43e52d09c427de99df)
  - [64eebf8](https://github.com/spring-projects/spring-framework/commit/64eebf86dd6d51ea4672f7f7c82d645538bd2696)
  - [6e335e3](https://github.com/spring-projects/spring-framework/commit/6e335e3a9ff7727dc42e790904ae98a6d0edb7b5)
  - [d370fca](https://github.com/spring-projects/spring-framework/commit/d370fcaa1778bd89f0c5c455a8ba33ceb4e5cedd)
  - [445f25c](https://github.com/spring-projects/spring-framework/commit/445f25c466c64f206f5f141c56a1b7cf63f3a30b)
  - [7a4207c](https://github.com/spring-projects/spring-framework/commit/7a4207cd7bfbe57217b1718111f8c56cb076a34d)
  - [f10998b](https://github.com/spring-projects/spring-framework/commit/f10998b7d24b7f086eab248382faa93c6943a84a)
  - [11d6822](https://github.com/spring-projects/spring-framework/commit/11d682292eeba75c100d1562aab875833929e1d7)
  - [a55c5eb](https://github.com/spring-projects/spring-framework/commit/a55c5eb324f8408ba29a2fecc4bd4c27890357c7)
  - [6f5cdf6](https://github.com/spring-projects/spring-framework/commit/6f5cdf6cab11bf9106e6aa0fbd30d2bf28fa6c33)
  - [88e6544](https://github.com/spring-projects/spring-framework/commit/88e6544d9d3498359b49a2548a1b6ef52b32a5ad)
  - [97625e3](https://github.com/spring-projects/spring-framework/commit/97625e365803526658d47a26cc6f010259154be1)

## 内容

[HTTP仕様](https://datatracker.ietf.org/doc/html/rfc2616#section-5.1.1)によれば、HTTPメソッドは既知のセット(GET、HEAD、PUT、POSTなど)に限定されず、「拡張メソッド」にもなり得ます。よく知られた拡張には、LOCK、COPY、MOVEなどのメソッドを追加した[WebDAV](http://www.webdav.org/specs/rfc4918.html#http.methods.for.distributed.authoring)があります。

Spring FrameworkではHTTPメソッドは`HttpMethod`に列挙されています。この型がJavaの`enum`であるため、Spring frameworkはenumに含まれないHTTPメソッドを許可するために、`HttpRequest::getMethod`と`HttpRequest::getMethodValue`の両方を持つなど、いくつかの回避策が必要です。

`HttpMethod`を`enum`から`class`に変更すれば、これらの回避策は不要になります。新しい`class`が`java.lang.Enum`が公開しているメソッドと同じメソッドを持つようにし、6.0へのアップグレードには再コンパイルが必要であることを考慮すれば、今がこの長年の懸案事項を変更する時だと考えています。

なお、このissueは、Spring MVCやWebFluxでの非標準HTTP(すなわちWebDAV)メソッドのサポートを*含みません*。

## コメント

### コメント 1 by quaff

**作成日**: 2021-11-25

> such as having both HttpMethod::getMethod as well as HttpRequest::getMethodValue.

`HttpMethod::getMethod`は`HttpRequest::getMethod`であるべきです。

### コメント 2 by poutsma

**作成日**: 2021-11-25

@quaff 修正しました、ありがとうございます!

### コメント 3 by quaff

**作成日**: 2021-12-01

`RequestMapping`で`extension-method`を使用できますか?

### コメント 4 by poutsma

**作成日**: 2021-12-01

> `RequestMapping`で`extension-method`を使用できますか?

それはどういう意味ですか? 詳しく説明していただけますか? アノテーションはenum要素を参照できますがclassは参照できないため、`RequestMapping`は`RequestMethod`列挙型を使用しています。

### コメント 5 by quaff

**作成日**: 2021-12-02

> > `RequestMapping`で`extension-method`を使用できますか?
> 
> それはどういう意味ですか? 詳しく説明していただけますか? アノテーションはenum要素を参照できますがclassは参照できないため、`RequestMapping`は`RequestMethod`列挙型を使用しています。

`extension-method`をサポートするために、`RequestMapping`に`String[] methodValue()`を導入すべきではないかということです。

### コメント 6 by poutsma

**作成日**: 2021-12-02

> `extension-method`をサポートするために、`RequestMapping`に`String[] methodValue()`を導入すべきではないかということです。

`RequestMapping`は`RequestMethod`を使用しており、そのままで問題ありません。説明文に記載したように、非標準HTTPメソッドをサポートする意図はありません。`HttpMethod`はHTTP抽象化に使用される低レベルコンポーネントであり、非標準メソッドのサポートが必要でした。

### コメント 7 by tamizh-m

**作成日**: 2024-05-28

こんにちは @poutsma、Spring 6にアップグレードした後、`ObjectMapper`を使用して`HttpMethod`のシリアライズとデシリアライズができなくなりました。classにpublicコンストラクタや`name`属性のgetterがないためです。以前HttpMethodがenumだった時にはこの問題は発生しませんでした。この回避策を提供していただけますか?

### コメント 8 by poutsma

**作成日**: 2024-05-28

@tamizh-m 新しいissueを登録してください。このissueはクローズされています。
