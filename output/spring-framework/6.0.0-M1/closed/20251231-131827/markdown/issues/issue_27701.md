# Retrieve MethodMetadata for all user-declared methods in the order of declaration

**Issue番号**: #27701

**状態**: closed | **作成者**: mp911de | **作成日**: 2021-11-19

**ラベル**: in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/27701

**関連リンク**:
- Commits:
  - [50c7c84](https://github.com/spring-projects/spring-framework/commit/50c7c848860fea9ae1ba8d9ce12a9ee7e2eee45f)

## 内容

Spring Data has a use-case in which it requires a stable method order (ordering of methods within a class file). To detect method ordering, it extended Spring Framework's `ClassMetadata` and ASM visitors to expose `Set<MethodMetadata> getMethods()`.

After removal of `AnnotationMetadataReadingVisitor`, there's no extension point available and Spring Data would have to hold a copy of all involved components to determine the method order.

It would be good to have access to `MethodMetadata` from `ClassMetadata`, ideally as `MethodMetadata[] getMethods()` or `Collection<MethodMetadata>`.

See for further reference:

https://github.com/spring-projects/spring-data-commons/blob/788457c90132ae7ca893791d091279faa8e76abe/src/main/java/org/springframework/data/type/MethodsMetadata.java

https://github.com/spring-projects/spring-data-commons/blob/788457c90132ae7ca893791d091279faa8e76abe/src/main/java/org/springframework/data/type/classreading/DefaultMethodsMetadataReader.java#L121-L162

## コメント

### コメント 1 by jhoeller

**作成日**: 2021-12-15

I ended up introducing `getDeclaredMethods()` on `AnnotationMetadata` since that is where `getAnnotatedMethods` lives already, and also since `MethodMetadata` includes annotation functionality as well. (The distinction between `ClassMetadata` and `AnnotationMetadata` is outdated in any case, with the present implementation we'll always retrieve full annotation metadata in any case.)

