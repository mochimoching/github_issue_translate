# Add method to ClientResponse that returns Mono terminating with createException

**Issue番号**: #27637

**状態**: closed | **作成者**: jwChung | **作成日**: 2021-11-04

**ラベル**: in: web, type: enhancement, status: feedback-provided

**URL**: https://github.com/spring-projects/spring-framework/issues/27637

**関連リンク**:
- Commits:
  - [7794606](https://github.com/spring-projects/spring-framework/commit/7794606305da37e5efbfeded67eb421208492339)

## 内容

[The method `ClientResponse.createException()` returns the `Mono<WebClientResponseException>` type.](https://github.com/spring-projects/spring-framework/blob/main/spring-webflux/src/main/java/org/springframework/web/reactive/function/client/ClientResponse.java#L182) `Mono<Exception>` feels like `Either<Exception, Exception>`. I think that the `Mono<RESULT>` type is actually needed. So, what if there is the `createError` method that returns the `Mono<RESULT>` type in the `ClientResponse` interface?



## コメント

### コメント 1 by poutsma

**作成日**: 2021-11-19

I can see the point for having a different exception, but can't you just `map` the `WebClientResponseException` to the type you'd like?

### コメント 2 by jwChung

**作成日**: 2021-11-26

@poutsma Isn't `Mono<T>.onErrorMap/onErrorResume` for that? 

In many cases, a returning value of `createException()` is changed to `Mono<RESULT>` in the following way.

```java
Mono<RESULT> mono = clientResponse.createException().flatMap(e -> Mono.error(new MyException("message", e)));
```

I wish I could just write it down as the following.

```java
Mono<RESULT> mono = clientResponse.createError().onErrorMap(e -> new MyException("message", e));
```

### コメント 3 by rstoyanchev

**作成日**: 2021-11-30

There is a related example in #27645 that doesn't even involve changing the exception. If you use `createException` from `exchangeToMono` and `exchangeToFlux` we have it documented as returning `Mono.error(response.createException())` but actually you need `response.createException().flatMap(Mono::error)` and that's only to be able to match the generic type of the result. It could also be `response.createException().cast(...)` but either way it's inconvenient.

It would make sense to align `createException` with `Mono#error` in terms of being able to cast to anything. After all an error signal switches from some type `T` to an `Exception` so this is to be expected. WDYT @poutsma?

### コメント 4 by poutsma

**作成日**: 2021-12-01

Personally I prefer the explicitness that the `Mono<WebClientResponseException>` return type offers, as opposed to a generic type. In the latter case, reading the javadoc of the method is pretty much required to see what it does, and that is not true for the former, which pretty much does what you expect from `createException`.

That said, by looking at #27645, I realise that the current signature is not ideal either and requires the use of a `flatMap`, which is not obvious. There is no reason against having both `createException` and `createError`, so I will add it.

