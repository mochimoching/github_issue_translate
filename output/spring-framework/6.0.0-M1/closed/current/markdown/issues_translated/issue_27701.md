# 宣言順にすべてのユーザー宣言メソッドのMethodMetadataを取得

**Issue番号**: [#27701](https://github.com/spring-projects/spring-framework/issues/27701)

**状態**: closed | **作成者**: mp911de | **作成日**: 2021-11-19

**ラベル**: in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/27701

**関連リンク**:
- Commits:
  - [50c7c84](https://github.com/spring-projects/spring-framework/commit/50c7c848860fea9ae1ba8d9ce12a9ee7e2eee45f)

## 内容

Spring Dataには、安定したメソッド順序(クラスファイル内のメソッドの順序)が必要なユースケースがあります。メソッドの順序を検出するために、Spring FrameworkのClassMetadataとASMビジターを拡張して`Set<MethodMetadata> getMethods()`を公開していました。

`AnnotationMetadataReadingVisitor`の削除後、利用可能な拡張ポイントがなく、Spring Dataはメソッドの順序を決定するために関連するすべてのコンポーネントのコピーを保持する必要があります。

`ClassMetadata`から`MethodMetadata`にアクセスできると良いでしょう。理想的には`MethodMetadata[] getMethods()`または`Collection<MethodMetadata>`として。

さらなる参照については以下を参照してください:

https://github.com/spring-projects/spring-data-commons/blob/788457c90132ae7ca893791d091279faa8e76abe/src/main/java/org/springframework/data/type/MethodsMetadata.java

https://github.com/spring-projects/spring-data-commons/blob/788457c90132ae7ca893791d091279faa8e76abe/src/main/java/org/springframework/data/type/classreading/DefaultMethodsMetadataReader.java#L121-L162

## コメント

### コメント 1 by jhoeller

**作成日**: 2021-12-15

`AnnotationMetadata`に`getDeclaredMethods()`を導入することにしました。`getAnnotatedMethods`が既にそこに存在しており、また`MethodMetadata`もアノテーション機能を含んでいるためです。(現在の実装では、`ClassMetadata`と`AnnotationMetadata`の区別は時代遅れです。いずれの場合も常に完全なアノテーションメタデータを取得します。)
