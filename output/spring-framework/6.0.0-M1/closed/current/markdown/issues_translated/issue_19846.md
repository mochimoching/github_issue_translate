# @DateTimeFormatでInstantのサポートを追加

**Issue番号**: [#19846](https://github.com/spring-projects/spring-framework/issues/19846)

**状態**: closed | **作成者**: spring-projects-issues | **作成日**: 2017-02-22

**ラベル**: in: web, in: core, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/19846

**関連リンク**:
- Commits:
  - [110e0f7](https://github.com/spring-projects/spring-framework/commit/110e0f7f2b0a07699a96bf6410299d95635b2f63)

## 内容

**[Krzysztof Krason](https://jira.spring.io/secure/ViewProfile.jspa?name=krzyk)** が **[SPR-15280](https://jira.spring.io/browse/SPR-15280?redirect=false)** を作成しコメント:

`@DateTimeFormat`アノテーションは、`Instant`を除くすべてのJava 8時間クラスでサポートされています。`Instant`は常に"2017-02-21T13:00:00Z"の形式を想定します。

現在、**start**を**2017-02-21T13:00**に設定してリクエストを行う場合、以下のコード(`LocalDateTime`を使用)は動作します:

```java
@RestController
public final class ReportController {

    @RequestMapping(path = "/test", method = RequestMethod.GET)
    public String report(
        @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd'T'HH:mm") LocalDateTime start) {
    return start.toString();
}
```

しかし、以下は動作しません(パース例外で失敗):

```java
@RestController
public final class ReportController {

    @RequestMapping(path = "/test", method = RequestMethod.GET)
    public String report(
        @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd'T'HH:mm") Instant start) {
    return start.toString();
}
```

---

**影響バージョン:** 4.3.6

投票数: 1, ウォッチャー: 2


## コメント

### コメント 1 by spring-projects-issues

**作成日**: 2017-03-15

**[Krzysztof Krason](https://jira.spring.io/secure/ViewProfile.jspa?name=krzyk)** がコメント:

何か進展はありますか? この動作は意図的なものですか?


### コメント 2 by spring-projects-issues

**作成日**: 2018-09-28

**[Krzysztof Krason](https://jira.spring.io/secure/ViewProfile.jspa?name=krzyk)** がコメント:

[Juergen Hoeller](https://jira.spring.io/secure/ViewProfile.jspa?name=juergen.hoeller)さん、何か進展はありますか?


### コメント 3 by YuryYaroshevich

**作成日**: 2019-05-09

この機能を実装する上での主な困難は、ゾーンIDを渡すことだと思います(ゾーンIDなしで`Instant`をフォーマットすることはできません: https://stackoverflow.com/questions/25229124/format-instant-to-string)。このフォーマッターに:

https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/format/datetime/standard/InstantFormatter.java#L42

ここで登録されています: https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/format/datetime/standard/DateTimeFormatterRegistrar.java#L192

### コメント 4 by eldarj

**作成日**: 2023-01-26

なぜこれが実際に動作しないのでしょうか?

上記とまったく同じサンプルでパーサー例外が発生します。

```java
@RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd'T'HH:mm") Instant start
```

気づいたのは、`Instant.parser`がリクエストパラメータをパースしようとしており、`TemporalAccessorParser`ではないということです。これは想定される動作ですか?

さらに、`Instant.parser`は`@DateTimeFormat`アノテーションで指定されたパターンを全く使用せず、常に`yyyy-MM-dd'T'HH:mm:ssz'`の形式(例: `2022-10-10T10:00:00Z`)を期待します。

@snicoll 何かアイデアはありますか? 

### コメント 5 by sbrannen

**作成日**: 2023-01-26

@eldarj さん、このissueは1年以上前にクローズされています。

バグに遭遇したと思われる場合は、新しいissueを作成し、動作を再現する最小限の例を提供してください。

カスタムフォーマットを考慮せずに`Instant.parse(...)`が呼び出される理由については、`org.springframework.format.datetime.standard.TemporalAccessorParser.defaultParse(String)`が呼び出されるフォールバックシナリオで発生する可能性があります。

### コメント 6 by eldarj

**作成日**: 2023-01-27

@sbrannen さん、迅速なアドバイスをありがとうございます。さらに確認して、必要に応じて新しいissueを開きます。ありがとうございました!
