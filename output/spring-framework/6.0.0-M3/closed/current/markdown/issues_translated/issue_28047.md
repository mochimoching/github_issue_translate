# Beanインスタンス化ジェネレーターインフラストラクチャの追加

**Issue番号**: #28047

**状態**: closed | **作成者**: snicoll | **作成日**: 2022-02-14

**ラベル**: in: core, type: enhancement, theme: aot

**URL**: https://github.com/spring-projects/spring-framework/issues/28047

**関連リンク**:
- Commits:
  - [9809752](https://github.com/spring-projects/spring-framework/commit/9809752c3c9b77e4fa6d1e06c9e1b080b6affb17)
  - [c541bde](https://github.com/spring-projects/spring-framework/commit/c541bde513443862e24e372c83f33e8c511d8903)
  - [572d017](https://github.com/spring-projects/spring-framework/commit/572d0173703e15a80e76eac2ad0bea9c56f35326)
  - [ea19b92](https://github.com/spring-projects/spring-framework/commit/ea19b92deb44fc74c04da6771afd714efeb79521)
  - [97986b3](https://github.com/spring-projects/spring-framework/commit/97986b368a42f858a8f6ee84e2ca4a79f17e7410)
  - [c5e1a77](https://github.com/spring-projects/spring-framework/commit/c5e1a774a5a1e27eb1ca693b663ec37e6583ac41)
  - [20b17f0](https://github.com/spring-projects/spring-framework/commit/20b17f02a29de8f10773d400b92f310fc6aba5a2)

## 内容

AOTの取り組みの一環として、Beanをインスタンス化するコードを生成できるインフラストラクチャが必要です。

これには、メソッド呼び出し、パラメータなどを記述するための低レベルのコード生成インフラストラクチャと、Beanインスタンスへのコントリビューションに使用できるAPIが含まれます。

このようなコントリビューターは、特に既存の`BeanPostProcessor`インフラストラクチャに基づいている必要があります。これらはBeanインスタンスに、AOTフェーズ中にコードに変換できるロジックを追加するためです。BPPは順序付けられているため、それらのコントリビューションも順序付けることができ、生成されたコードを実行することによって適用される順序が一致します。

コード生成を容易にするために、最初のバージョンでは非常に基本的なものに焦点を当てたインフラストラクチャが必要です。次のようなものです:

```java
BeanDefinitionRegistrar.of("restTemplateClientService", RestTemplateClientService.class)
	  .withConstructor(RestTemplateBuilder.class)
	  .instanceSupplier((instanceContext) -> instanceContext.create(beanFactory, (attributes) ->
			  new RestTemplateClientService(attributes.get(0))))
	  .register(beanFactory);
```

これは、`RestTemplateBuilder`を必要とする`restTemplateClientService` Beanを登録します。ビルド時にすべての依存関係解決を行うのではなく、`instanceContext`を介してフレームワークの依存関係解決アルゴリズムを活用します。これは、Beanをインスタンス化するために使用する`Executable`(ここでは`RestTemplateBuilder`を取るコンストラクタ)に従って解決された属性を提供できます。
