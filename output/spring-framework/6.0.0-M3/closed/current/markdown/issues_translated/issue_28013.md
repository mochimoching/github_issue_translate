# 複数のinitおよびdestroyメソッド名の登録サポートを追加

**Issue番号**: #28013

**状態**: closed | **作成者**: snicoll | **作成日**: 2022-02-07

**ラベル**: in: core, type: enhancement, theme: aot

**URL**: https://github.com/spring-projects/spring-framework/issues/28013

**関連リンク**:
- Commits:
  - [41ee233](https://github.com/spring-projects/spring-framework/commit/41ee23345d72623d18accb9484ce5119403c39d5)

## 内容

`BeanDefinition`は`init`および`destroy`メソッド名を持つことができます。一般的ではありませんが、Beanが複数のそのようなメソッドを持つことは可能です。`InitDestroyAnnotationBeanPostProcessor`を参照してください。

これらのアノテーションを検索する実行時動作を置き換えるには、複数のinitおよびdestroyメソッド名を指定する方法が必要です。`RootBeanDefinition`の`isExternallyManagedConfigMember`にも影響がある可能性があります。

## コメント

### コメント 1 by snicoll

**作成日**: 2022-02-07

Spring Nativeでこの機能をサポートするために行ったことをレビューすると、`MergedBeanDefinitionPostProcessor`を尊重すれば、複数のinit/destroyメソッド名を追加するだけでこのユースケースをサポートできるように見えます。

現在のコードは、検出されたメソッドを外部管理として登録します。代わりに「単に」登録し、新しいコードにメソッドを呼び出させることができます。

### コメント 2 by chenggwang

**作成日**: 2025-06-16

> `BeanDefinition`は`init`および`destroy`メソッド名を持つことができます。一般的ではありませんが、Beanが複数のそのようなメソッドを持つことは可能です。`InitDestroyAnnotationBeanPostProcessor`を参照してください。
> 
> これらのアノテーションを検索する実行時動作を置き換えるには、複数のinitおよびdestroyメソッド名を指定する方法が必要です。`RootBeanDefinition`の`isExternallyManagedConfigMember`にも影響がある可能性があります。

こんにちは、snico!これまでのところ、このサポートはAOTでのみ使用されているようです。他のSpringモジュールでは使用されていないようです。たとえば、少なくとも@bean(initMethod={"init1",init2,..." })、XML設定への拡張は明らかにサポートされていません。他の場所では必要ないようです。したがって、このメソッドはprotectedに設定すべきでしょうか? beanDefinition.SetDestroyMethodNames(init1, init2)に直接アクセスできるためです。もし本当に汎用性が必要な場合、初期化メソッドの実行順序をどのように保証しますか? そしてどのように調整しますか?

### コメント 3 by snicoll

**作成日**: 2025-06-16

実際の問題がありますか? もしそうであれば、それを示すサンプルを含む新しい課題を作成してください。そうすれば確認できます。

### コメント 4 by chenggwang

**作成日**: 2025-06-17

> 実際の問題がありますか? もしそうであれば、それを示すサンプルを含む新しい課題を作成してください。そうすれば確認できます。

実際の問題は見つかりませんでした。Springを使用中に、Beanが`beanDefinition.SetInitMethodNames(init1, init2)`または`beanDefinition.SetDestroyMethodNames(destruct1, destruct12)`のいずれかを使用して複数の初期化または破棄メソッドを持つことができることを発見しました。これらのメソッドは3年前にあなたによって提出されました。AOTのみがサポートされている場合、これらのメソッドは外部から呼び出せないようにパッケージ内で可視にすべきでしょうか? Beanの複数初期化メソッドがサポートされている場合、@bean(initMethod={"init1", init2,...})を実装します。複数の初期化メソッドをサポートします。ローカルで実装を変更しており、コードを提出できます。
