# RFC 7807の問題詳細と例外を表す型の追加

**Issue番号**: #28187

**状態**: closed | **作成者**: rstoyanchev | **作成日**: 2022-03-16

**ラベル**: in: web, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/28187

## 内容

この課題の目標は、RFC 7807の問題詳細の表現を追加し、Spring MVCとSpring WebFluxのエラーレスポンス処理に統合することです。

WebFlux側には、HTTPステータス、理由、ヘッダーを含む`ResponseStatusException`階層があります。ここにボディとして`ProblemDetail`を追加できるようになります。これにより、例外内のすべてのエラーレスポンス詳細の完全なカプセル化が提供されます。

Spring MVC側には、例外をHTTPステータスとヘッダーにマッピングする`DefaultHandlerExceptionResolver`があるため、例外自体はその情報を含みません。さらに、例外階層には、これを追加できる単一の基底クラスがありません。エラーレスポンスを表すインターフェース、たとえば`ErrorResponse`を追加できます。これは、WebFlux側の`ResponseStatusException`から公開される情報と同様です。その後、すべてのSpring MVC例外にこれを実装させて公開すれば、`DefaultHandlerExceptionResolver`はもはやマッピングロジックを必要としません。

`ResponseEntityExceptionHandler`は、エラー詳細をレンダリングするために`@ExceptionHandler`メソッドを使用するコントローラーアドバイスの基底クラスです。これはしばらく前から存在していますが、これまでアプリケーションはエラーボディフォーマットを決定するためにそれを拡張する必要がありました。今では空白を埋め、そのような情報を公開する`ResponseError`例外に対して`ProblemDetail`を使用できます。WebFluxには同様のクラスが存在しませんが、追加できます。

Spring MVCとWebFluxの両方の`ResponseEntity`処理は、戻り値の型として`ProblemDetail`と`ErrorResponse`をサポートし、それに応じてレスポンスのステータス、ヘッダー、ボディを自動的に設定する必要があります。これは、`instance`が設定されていない場合のフォールバックとして、`ProblemDetail`の`instance`フィールドをリクエストパスに設定する機会でもあります。

## コメント

### コメント 1 by rstoyanchev

**作成日**: 2022-03-16

包括的課題#27052にリンクされているコミットを参照してください。
