# KotlinBodySpecを適切なResponseSpec拡張に置き換え

**Issue番号**: #28144

**状態**: closed | **作成者**: sdeleuze | **作成日**: 2022-03-08

**ラベル**: in: test, type: enhancement, theme: kotlin

**URL**: https://github.com/spring-projects/spring-framework/issues/28144

**関連リンク**:
- Commits:
  - [617ba84](https://github.com/spring-projects/spring-framework/commit/617ba845771f8cf6d8f7e30ba8ff66214e97bc54)
  - [afa307e](https://github.com/spring-projects/spring-framework/commit/afa307e7dca4458c08a7a53ecb9ae8fd37a6dddd)
  - [1be3eec](https://github.com/spring-projects/spring-framework/commit/1be3eecb2a088af4c5b9bc44c8a68cc724074be3)

## 内容

#20606により、Spring Framework 5.0.xで`KotlinBodySpec`を導入する必要がありました。これは、Kotlinでの`WebTestClient`の最も一般的なユースケースについてKotlin開発者を支援するためです。

[Kotlin 1.6以降、再帰的なジェネリック型に関する関連するKotlin課題が修正されました](https://blog.jetbrains.com/kotlin/2021/11/kotlin-1-6-0-is-released/#improved-type-inference-for-recursive-generic-types)。これにより、Spring Frameworkが`ParameterizedTypeReference`を取る`ResponseSpec`メソッド用の通常のreified拡張を提供することが可能になります(もちろん検証が必要ですが、これが現在の理解です)。

その結果、Spring Framework 6で`KotlinBodySpec`を削除し、現在の`inline fun <reified B : Any> ResponseSpec.expectBody(): KotlinBodySpec<B>`拡張も削除し、`ResponseSpec.expectBody`用の通常のreified拡張を導入することを提案します。`ResponseSpec.expectBodyList`、`ResponseSpec.returnResult`拡張はすでに存在しているためです。

これは破壊的変更であり、残念ながら回避不可能だと思われるため、リリースノートで言及すべきです。Spring Framework 5.3で関連する拡張を非推奨にすべきかどうかは分かりません。そこではKotlin 1.5をサポートする必要があり、現在の拡張がこの課題で説明されている新しい適切な拡張の導入を妨げるためです。

## コメント

### コメント 1 by sdeleuze

**作成日**: 2022-03-16

[KT-5464の関連コメント](https://youtrack.jetbrains.com/issue/KT-5464#focus=Comments-27-5878033.0-0)を参照してください。そこで、これがKotlin 1.6+で使用可能になったものの、KotlinはまだJavaよりも冗長であるため、改善の余地があることを議論しました。
