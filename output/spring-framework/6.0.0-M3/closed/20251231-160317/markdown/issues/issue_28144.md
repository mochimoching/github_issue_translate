# Replace KotlinBodySpec with proper ResponseSpec extensions

**Issue番号**: #28144

**状態**: closed | **作成者**: sdeleuze | **作成日**: 2022-03-08

**ラベル**: in: test, type: enhancement, theme: kotlin

**URL**: https://github.com/spring-projects/spring-framework/issues/28144

**関連リンク**:
- Commits:
  - [617ba84](https://github.com/spring-projects/spring-framework/commit/617ba845771f8cf6d8f7e30ba8ff66214e97bc54)
  - [afa307e](https://github.com/spring-projects/spring-framework/commit/afa307e7dca4458c08a7a53ecb9ae8fd37a6dddd)
  - [1be3eec](https://github.com/spring-projects/spring-framework/commit/1be3eecb2a088af4c5b9bc44c8a68cc724074be3)

## 内容

Due to #20606, we had to introduce `KotlinBodySpec` in Spring Framework 5.0.x in order to unlock Kotlin developers for most common use cases of `WebTestClient` in Kotlin.

[As of Kotlin 1.6, the related Kotlin issue on recursive generic types has been fixed](https://blog.jetbrains.com/kotlin/2021/11/kotlin-1-6-0-is-released/#improved-type-inference-for-recursive-generic-types), making it possible for Spring Framework to provide regular reified extensions for `ResponseSpec` methods that takes a `ParameterizedTypeReference` (to be verified of course, but that's my current understanding).

As a consequence, my proposal is in Spring Framework 6 to remove `KotlinBodySpec`, as well as the current `inline fun <reified B : Any> ResponseSpec.expectBody(): KotlinBodySpec<B>` extension, and introduce regular reified extensions for `ResponseSpec.expectBody` since `ResponseSpec.expectBodyList`, `ResponseSpec.returnResult` extensions already exists.

This is a breaking change, I am afraid impossible to avoid, so it should be mentioned in the release notes. I am not sure we should deprecate the related extension in Spring Framework 5.3 since we need to support Kotlin 1.5 there and the current extension prevent to introduce the new proper one describe in this issue.

## コメント

### コメント 1 by sdeleuze

**作成日**: 2022-03-16

See [related comment in KT-5464](https://youtrack.jetbrains.com/issue/KT-5464#focus=Comments-27-5878033.0-0) where we discussed the fact that while this is now usable with Kotlin 1.6+, Kotlin is still more verbose than Java so there is room for improvement.

