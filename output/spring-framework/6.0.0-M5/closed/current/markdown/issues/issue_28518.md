# Add reflection hints for Web controllers

**Issue番号**: #28518

**状態**: closed | **作成者**: snicoll | **作成日**: 2022-05-24

**ラベル**: type: enhancement, theme: aot

**URL**: https://github.com/spring-projects/spring-framework/issues/28518

**関連リンク**:
- Commits:
  - [c956c06](https://github.com/spring-projects/spring-framework/commit/c956c06077a2c2c210bb79c5ef72d7a4527c041d)
  - [966e46c](https://github.com/spring-projects/spring-framework/commit/966e46c833bba197382aa2c1224c67d8576e918c)
  - [6bc1f33](https://github.com/spring-projects/spring-framework/commit/6bc1f3365a604545c8ba2f31efc19398b4e784b8)
  - [3574f3d](https://github.com/spring-projects/spring-framework/commit/3574f3d2c0ba128d967c7e9772e7ed2f32c9619a)
  - [9aefe70](https://github.com/spring-projects/spring-framework/commit/9aefe70bab08b4968e63178fa7e1ee00b8e69ac1)
  - [10244cf](https://github.com/spring-projects/spring-framework/commit/10244cfdd44e6af28bf9eacc5e3388487b35ecc7)
  - [5b21e65](https://github.com/spring-projects/spring-framework/commit/5b21e65f2ad6debc6d32291b2711adfd038669d9)
  - [bc065e8](https://github.com/spring-projects/spring-framework/commit/bc065e8f8344b1c5d1f74f4b39c77e2ef753d06d)
  - [239e979](https://github.com/spring-projects/spring-framework/commit/239e979e5ab5eac58e7fc3134137ae256cc01375)
  - [48d022d](https://github.com/spring-projects/spring-framework/commit/48d022d35ea9df900c84d1ccb7dead868821872c)
  - [ef3f465](https://github.com/spring-projects/spring-framework/commit/ef3f4655326b03860ff20a2b3cde370c3666ef84)
  - [a57dead](https://github.com/spring-projects/spring-framework/commit/a57dead4be7e19c423df867852380b38c1f5ddbc)
  - [0992f85](https://github.com/spring-projects/spring-framework/commit/0992f855e64216970cb2c3f92cf6e6eab0ad62e4)
  - [12d756a](https://github.com/spring-projects/spring-framework/commit/12d756a2520dbd65f55d342ef83a9ce9ea8b4931)
  - [5e56d9c](https://github.com/spring-projects/spring-framework/commit/5e56d9cb2171ff8bb051a8a5c30fbfeae1301d36)
  - [90dcbe8](https://github.com/spring-projects/spring-framework/commit/90dcbe85bde899b9f9d2a1d16d952946806b9fb3)
  - [dee47c3](https://github.com/spring-projects/spring-framework/commit/dee47c366e909dc50978fa19b3dc06a9d73a182d)
  - [2b76a12](https://github.com/spring-projects/spring-framework/commit/2b76a12b86a62cc46886e1b7f0e52ea9d256f899)
  - [ecf39cf](https://github.com/spring-projects/spring-framework/commit/ecf39cfaa6055513ee9918951099aba870ae8c74)
  - [3491563](https://github.com/spring-projects/spring-framework/commit/349156368ffa0a35a7565c1a1f8aeae636a9b666)

## 内容

The core framework invokes `@RequestMapping`-annotated methods (`@GetMapping`, etc) using reflection. To run in a native image, we need hints for those. We may also want to infer that return types are going to be serialized, or that input times are going to be mapped from the request.

All this can go away if we generate an optimized code for the router but let's go the hints route for now.

## コメント

### コメント 1 by snicoll

**作成日**: 2022-05-24

For the annotations themselves and loading `org/springframework/http/mime.types` it would be nice if those were contributed only if the application is going to use it. Adding a `RuntimeHintsRegistrar` in `aot.factories` would not achieve that goal but it's not clear cut where to put `@ImportRuntimeHints`. As it should be consistent, we can't really rely on Spring Boot for that. 

For the annotations, I was tempted to add an import on `org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping` but it's not obvious that's going to be a bean so the annotation there feels a little bit odd.

### コメント 2 by snicoll

**作成日**: 2022-05-24

Considering that `MergedAnnotations` is required to automatically handle the creation of the proxy. I wonder if dealing with everything that is method specific can be a good thing. This would be more code but more tailored to what is actually happening in the application.

### コメント 3 by sdeleuze

**作成日**: 2022-06-08

I managed to make `webmvc-tomcat` sample working with https://github.com/sdeleuze/spring-framework/tree/gh-28518. I will refine it based on @snicoll feedback.

### コメント 4 by sdeleuze

**作成日**: 2022-06-13

This issue will be focused on reflection hints for controllers and reflection-based serialization of parameters annotated
with `@RequestBody` and return values annotated with `@ResponseBody`. I will create subsequent issues for other use-cases (`HttpEntity`, `@ControllerAdvice`, etc.)

