# Use PathPatternParser by default in Spring MVC

**Issue番号**: #28607

**状態**: closed | **作成者**: rstoyanchev | **作成日**: 2022-06-10

**ラベル**: in: web, type: enhancement

**URL**: https://github.com/spring-projects/spring-framework/issues/28607

**関連リンク**:
- Commits:
  - [8a9b082](https://github.com/spring-projects/spring-framework/commit/8a9b082d8a0f84e7b72416e57e9b6a7a9321567e)
  - [92cf1e1](https://github.com/spring-projects/spring-framework/commit/92cf1e13e8770aae306886555ed8210d95464d46)
  - [14fd260](https://github.com/spring-projects/spring-framework/commit/14fd2605a39462f7ae3d0377aac249a171908a91)

## 内容

`PathPatternParser` was introduced for WebFlux in 5.0 as a replacement for `AntPathMatcher` that uses pre-compiled patterns, supports mapping without decoding the full URL path, and optimizes the pattern syntax for web (vs file system) paths. 

It has been available for use in Spring MVC since version 5.3 and has been enabled as the default in Spring Boot since version 2.6 with https://github.com/spring-projects/spring-boot/issues/24805.

This issue is to consider switching the default in Spring Framework to `PathPatternParser` for 6.0, and potentially deprecate `PathMatcher` and related options.




## コメント

### コメント 1 by bclozel

**作成日**: 2022-06-21

I think we should do this (including the deprecation) for 6.0.

### コメント 2 by rstoyanchev

**作成日**: 2022-06-21

**Team decision:** we'll go ahead with it and align with the default in Boot. 

### コメント 3 by rstoyanchev

**作成日**: 2022-06-29

Parsed patterns are now enabled by default in Spring MVC. This means, each `HandlerMapping`, or rather every subclass of `AbstractHandlerMapping` has a `PathPatternParser` instance, and that effectively means parsed patterns are used instead of String path matching with `AntPathMatcher`. 

To minimize unnecessary breakage where intentions are clear, String path matching is still enabled through the MVC config, when either of the following is true:
- `PathPatternParser` is not explicitly set, while `AntPathMatcher` or `UrlPathHelper` related options are customized.
- `PathPatternParser` is explicitly set to `null`.

Further steps have also been taken to minimize failures in existing tests. For example the URL path is parsed per handler lookup if not called by the `DispacherServlet`, which pre-parses and caches the path. Likewise, `MockHttpServletRequest` detects a Servlet path mapping, to ensure a Servlet path prefix is taken into account.




