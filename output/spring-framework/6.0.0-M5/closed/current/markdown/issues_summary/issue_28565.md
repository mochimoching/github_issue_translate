*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

`ApplicationContextAotGenerator`が生成するBean登録クラスの名前とパッケージをカスタマイズできるようにする機能強化です。従来は常に`__.BeanFactoryRegistrations`という固定名で生成されていました。

**背景説明**:
- **ApplicationContextAotGenerator**: AOT処理でSpringアプリケーションコンテキストのBean登録コードを生成するクラス
- **`__`パッケージ**: Spring Frameworkが生成コードを配置するための特殊なパッケージ（ダブルアンダースコア）
- **コンテキスト階層**: 親子関係を持つ複数のApplicationContextの構造

**問題の詳細**:
現状の固定的な生成クラス名：
```java
// 常に以下のクラス名で生成される
package __;

public class BeanFactoryRegistrations {
    public static void registerBeanDefinitions(
            DefaultListableBeanFactory beanFactory) {
        // Bean登録コード
    }
}
```

**課題**:
1. **コンテキスト階層サポートの困難**:
   ```java
   // 親コンテキスト用のBean登録
   __.BeanFactoryRegistrations.registerBeanDefinitions(parentContext);
   
   // 子コンテキスト用のBean登録
   __.BeanFactoryRegistrations.registerBeanDefinitions(childContext);
   // ❌ 同じクラス名で競合
   ```

2. **パッケージの制限**:
   - `__`パッケージに固定されている
   - アプリケーションクラスと同じパッケージに配置したい場合がある（可視性の問題回避）

3. **Spring Bootとの統合**:
   - `@SpringBootApplication`クラスと同じパッケージに配置したい
   - より直感的なパッケージ構造

## 原因

`ApplicationContextAotGenerator`の初期実装が、単一のApplicationContextのみを想定し、生成クラス名を固定していました。

コンテキスト階層や複雑な構成をサポートするには、柔軟な命名が必要でしたが、そのAPIが提供されていませんでした。

## 対応方針

以下のコミットで実装されました：

- [172102d](https://github.com/spring-projects/spring-framework/commit/172102d225c916e2ca24b87aa0f0a74d824815b2): 基本機能の追加
- [4bd33cb](https://github.com/spring-projects/spring-framework/commit/4bd33cb6e0659df2cd0b9fa04feea8fd77e5a16d): 関連する`ClassNameGenerator`の改善

**実装内容**:

`ApplicationContextAotGenerator`にターゲットクラスを指定可能に：

```java
// 新しいAPI
ApplicationContextAotGenerator generator = new ApplicationContextAotGenerator();

// ターゲットクラスを指定して生成
Class<?> targetClass = MyApplication.class;
generator.generate(context, targetClass);

// 生成されるクラス
package com.example;  // MyApplicationと同じパッケージ

public class MyApplication__BeanFactoryRegistrations {
    public static void registerBeanDefinitions(
            DefaultListableBeanFactory beanFactory) {
        // Bean登録コード
    }
}
```

**コンテキスト階層での使用例**:
```java
// 親コンテキスト用
generator.generate(parentContext, ParentApplication.class);
// → com.example.ParentApplication__BeanFactoryRegistrations

// 子コンテキスト用
generator.generate(childContext, ChildApplication.class);
// → com.example.child.ChildApplication__BeanFactoryRegistrations

// ✅ 異なるクラス名で競合なし
```

**Spring Bootでの使用**:
```java
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}

// AOT処理時
ApplicationContextAotGenerator generator = ...;
generator.generate(context, MyApplication.class);

// 生成されるクラス（MyApplicationと同じパッケージ）
package com.example;

public class MyApplication__BeanFactoryRegistrations {
    // Bean登録コード
}
```

**デフォルト動作の維持**:
```java
// ターゲットを指定しない場合（後方互換性）
generator.generate(context, null);
// → __.BeanFactoryRegistrations（従来通り）
```

**命名ルール**:
```
ターゲットクラス指定あり:
  <TargetPackage>.<TargetClassName>__BeanFactoryRegistrations

ターゲットクラス指定なし:
  __.BeanFactoryRegistrations
```

**メリット**:
- コンテキスト階層のサポート
- より直感的なパッケージ配置
- 可視性問題の回避が容易
- Spring Bootとの統合が改善
- 柔軟な命名戦略

**関連課題**: [#28517](https://github.com/spring-projects/spring-framework/issues/28517) - `ClassNameGenerator`の改善
