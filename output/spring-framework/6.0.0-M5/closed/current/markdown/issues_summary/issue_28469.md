*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

AOT（Ahead-of-Time）コンパイル、特にGraalVM Native Imageでの実行時に、リフレクションヒントが必要なアノテーションを自動的に識別するためのメタアノテーション`@Reflective`を導入する機能強化です。

**背景説明**:
- **AOT（Ahead-of-Time）**: 実行前にコンパイルを行う方式。起動時間の短縮とメモリ使用量の削減が可能
- **GraalVM Native Image**: Javaアプリケーションをネイティブバイナリにコンパイルする技術
- **リフレクションヒント**: ネイティブイメージビルド時に、どのクラス/メソッドがリフレクション経由でアクセスされるかを事前に宣言する必要がある
- **メタアノテーション**: アノテーションに付けるアノテーション。アノテーションの動作を定義

**問題の詳細**:
ネイティブイメージでは、リフレクションで呼び出されるコードに対して事前にヒントを提供する必要があります。以下のような一般的なパターンで問題が発生：

1. `@EventListener`付きメソッド → リフレクション経由で呼び出される
2. `@GetMapping`などのコントローラーメソッド → リフレクション経由で呼び出され、戻り値もシリアライズされる

現状では、各パターンに対して専用の`BeanRegistrationAotProcessor`や`BeanFactoryInitializationAotProcessor`を実装する必要がありました。

## 原因

AOTコンパイルで必要なリフレクションヒントを半自動的に生成する汎用的な仕組みが不足していたため。

アノテーションごとに個別のプロセッサーを書く必要があり：
- コード重複が多い
- 保守コストが高い
- 新しいアノテーションへの対応が遅れる

## 対応方針

以下のコミットで実装されました：

- [255a52b](https://github.com/spring-projects/spring-framework/commit/255a52bc7a5f10a1f142f45e4ef7118f241314aa)
- [4cca190](https://github.com/spring-projects/spring-framework/commit/4cca190aad3cf643c765f39655432e0ebd00549e)

**実装内容**:

1. **@Reflectiveメタアノテーションの導入**:
```java
@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Reflective
public @interface EventListener { ... }
```

2. **汎用AOTプロセッサー**:
- `@Reflective`が付いたアノテーションを自動検出
- 戦略パターンでヒント生成ロジックをカスタマイズ可能（`@Conditional`と同様）
- 個別プロセッサーの実装不要

**メリット**:
- リフレクションが必要なアノテーションを明示的にマーク
- ヒント生成の自動化
- 保守コストの削減
- 拡張性の向上（新しいアノテーションへの対応が容易）

**将来の展望**:
このメタアノテーションは一時的なものにできます。将来、Spring Framework全体がAOTで完全に解決され、リフレクションの必要性がなくなれば、`@Reflective`は削除可能です。
