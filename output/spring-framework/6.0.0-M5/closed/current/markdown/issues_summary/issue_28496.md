*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

`org.springframework.aot`パッケージと`org.springframework.core`パッケージ間のパッケージサイクル（循環依存）を解消するリファクタリングタスクです。

**背景説明**:
- **パッケージサイクル**: 2つのパッケージがお互いに依存し合っている状態。コードの保守性や可読性を損なう
- **spring-core**: Springの基盤機能を提供するモジュール
- **spring-context**: Beanコンテナなどの高レベル機能を提供するモジュール
- **ヒントレジストラ**: AOT/ネイティブイメージビルド時に必要なリフレクションヒントなどを登録するコンポーネント

**問題の詳細**:
最近追加された2つのヒントレジストラにより、以下のパッケージ間でサイクルが発生：
- `org.springframework.aot` → `org.springframework.core`への依存
- `org.springframework.core` → `org.springframework.aot`への依存

このサイクルは設計上望ましくなく、モジュール間の依存関係が複雑になります。

## 原因

ヒントレジストラの配置場所が適切でなかったため：

1. **SpringFactoriesヒントレジストラ**:
   - `SpringFactories`のpackage-protectedメソッドに依存
   - `spring-core`に配置する必要があるが、AOT機能にも関連

2. **配置の難しさ**:
   - `spring-core`はAOT機能を知るべきではない（レイヤリング違反）
   - しかし、ヒントレジストラは`spring-core`の内部実装にアクセスする必要がある

## 対応方針

[16eff68](https://github.com/spring-projects/spring-framework/commit/16eff6835748be5316520b313e08a8a481b900d1)のコミットで修正されました。

**検討された解決策**:

1. **spring-contextへの移動** (初期案):
   - ヒントレジストラを`spring-context`に移動
   - 理由: コンテキストなしでは実際に有用でない

2. **org.springframework.aot.supportパッケージの作成** (採用案):
   - `org.springframework.core`のアイテムのヒント登録を担当する専用パッケージを作成
   - AOTサポート機能を明示的に分離

3. **SpringFactoriesLoaderの修正**:
   - `loadFactoriesResource`メソッドを`protected static`にする
   - または、publicメソッドとして公開
   - プライベートサブクラスでアクセス可能にする

**最終的な解決**:
パッケージ構造を再編成し、AOTサポート機能を適切なレイヤーに配置することでサイクルを解消しました。

**今後の改善提案**:
レイヤリングを強制するCheckstyleルールの導入が提案されています。これにより、今後同様の問題を早期に検出できます。

**設計原則**:
- 低レベルモジュール（spring-core）は高レベル概念（AOT）に依存すべきでない
- サイクルのない明確なモジュール階層を維持
