*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

JVM上でAOT（Ahead-of-Time）処理モードを検出し、適切に動作を切り替えるための`AotDetector`を導入する機能強化です。

**背景説明**:
- **AOT処理**: アプリケーション起動前にコンパイルや最適化を行う処理。ビルド時とランタイムで動作が異なる
- **ネイティブイメージ**: GraalVMを使用してJavaアプリケーションをネイティブバイナリにコンパイルしたもの
- **Native Build Tools**: GraalVMのネイティブイメージビルドツール

**問題の詳細**:
現状では、ネイティブイメージのビルド時に設定されるシステムプロパティに依存してAOTモードを判定していますが、これには以下の問題があります：

1. 本当に動作を変えるべき箇所（ネイティブイメージ vs JVM）以外でも判定に使用されている
2. JVM上でAOT処理を使用したい場合の明示的なオプトイン方法がない
3. AOTビルド時とAOT最適化されたJVM実行時の区別が不明確

## 原因

AOTモードの検出ロジックが統一されておらず、システムプロパティに直接依存する実装が各所に散在していたため。

異なる実行モードを適切に区別する必要があります：
- **ビルド時AOT**: AOT処理を実行している時（メタデータ生成、コード生成）
- **ランタイムAOT**: AOTで最適化されたコンテキストをJVM上で実行している時
- **ネイティブイメージ**: GraalVM Native Imageとして実行している時

## 対応方針

以下のコミットで実装されました：

- [da8c4de](https://github.com/spring-projects/spring-framework/commit/da8c4de263835afb3adf2c26ab62afb214157b85)
- [c606f75](https://github.com/spring-projects/spring-framework/commit/c606f757739aa30e801ca20837e51905dbb09560)
- [a9295e8](https://github.com/spring-projects/spring-framework/commit/a9295e877e4388e83bf09b633de31486e30f1963)

**実装内容**:

`AotDetector`クラスを導入し、実行モードを統一的に検出：

```java
public class AotDetector {
    // AOT処理中かどうかを検出
    public static boolean useGeneratedArtifacts();
    
    // ネイティブイメージで実行中かどうかを検出
    public static boolean inNativeImage();
}
```

**参考実装**:
Spring Nativeプロジェクトの[`AotModeDetector`](https://github.com/spring-projects-experimental/spring-native/blob/d176e2d360350c5f91d0a44f9b7fefddd3f6d2db/spring-native/src/main/java/org/springframework/nativex/AotModeDetector.java#L29)を参考にしています。

**関連課題**: [#28205](https://github.com/spring-projects/spring-framework/issues/28205)

**メリット**:
- AOTモードの検出ロジックが統一され、保守性向上
- JVM上でのAOT使用が明示的にオプトイン可能
- 実行コンテキストに応じた適切な動作切り替えが可能
