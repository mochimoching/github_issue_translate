*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

`@HttpExchange`アノテーションをメソッドレベルでも使用できるようにし、カスタムHTTPメソッドやOPTIONSなどの標準的でないHTTPメソッドをサポートする機能強化です。

**背景説明**:
- **@HttpExchange**: HTTPクライアントインターフェースを宣言的に定義するための基底アノテーション
- **HTTPメソッド**: GET、POST、PUT、DELETE、PATCH、OPTIONS、HEADなど
- **ショートカットアノテーション**: `@GetExchange`、`@PostExchange`など、特定のHTTPメソッド専用のアノテーション

**問題の詳細**:
現状の制限：
- `@HttpExchange`はクラスレベルでのみ使用可能（共通設定の継承用）
- メソッドレベルでは`@GetExchange`、`@PostExchange`などの専用アノテーションを使う必要がある
- カスタムHTTPメソッド（例: PATCH、MERGE）や、専用ショートカットのないメソッド（OPTIONS、HEAD）の定義が困難

**要望**:
メソッドレベルでも`@HttpExchange`を使用し、任意のHTTPメソッドを指定できるようにしたい：
```java
public interface CustomClient {
    // カスタムHTTPメソッド
    @HttpExchange(method = "MERGE", url = "/resources/{id}")
    void mergeResource(@PathVariable String id);
    
    // OPTIONSメソッド
    @HttpExchange(method = "OPTIONS", url = "/api")
    HttpHeaders getOptions();
}
```

## 原因

`@HttpExchange`の初期設計が、クラスレベルでの共通属性定義のみを想定しており、メソッドレベルでの使用を考慮していませんでした。

一般的なHTTPメソッド（GET、POST、PUT、DELETE、PATCH）には専用ショートカットが提供されていますが、それ以外のメソッドやカスタムメソッドに対応する手段がありませんでした。

## 対応方針

[ff890bc](https://github.com/spring-projects/spring-framework/commit/ff890bc1cc11381a3cfffa66f9be9f013adc0b51)のコミットで実装されました。

**実装内容**:

`@HttpExchange`をメソッドレベルでも使用可能に拡張：

```java
@Target({ElementType.TYPE, ElementType.METHOD})  // METHODを追加
@Retention(RetentionPolicy.RUNTIME)
public @interface HttpExchange {
    String method() default "";  // HTTPメソッド名を指定可能
    String url() default "";
    String contentType() default "";
    String accept() default "";
}
```

**使用例**:
```java
@HttpExchange("https://api.example.com")
public interface ApiClient {
    // OPTIONSメソッド
    @HttpExchange(method = "OPTIONS", url = "/resources")
    HttpHeaders checkOptions();
    
    // HEADメソッド
    @HttpExchange(method = "HEAD", url = "/resources/{id}")
    HttpHeaders checkExists(@PathVariable String id);
    
    // カスタムメソッド (WebDAVなど)
    @HttpExchange(method = "PROPFIND", url = "/webdav/{path}")
    String propFind(@PathVariable String path);
    
    // 既存のショートカットも引き続き使用可能
    @GetExchange("/resources")
    List<Resource> getResources();
}
```

**メリット**:
- すべてのHTTPメソッドに対応可能
- カスタムHTTPメソッドのサポート
- WebDAVなどの拡張プロトコルでの使用
- API定義の柔軟性向上
- ショートカットアノテーションとの併用も可能
