*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

アノテーション自体が`@AliasFor`を使用している場合に、JDKプロキシヒントが登録されず、ネイティブイメージでエラーが発生するバグの修正です。

**背景説明**:
- **@AliasFor**: アノテーション属性間のエイリアス（別名）関係を定義するSpringのメタアノテーション
- **プロキシヒント**: ネイティブイメージビルド時に、動的プロキシ生成に必要なヒント情報
- **ローカル属性のエイリアス**: 同じアノテーション内の異なる属性名を相互に参照できるようにする機能

**問題の詳細**:
以下のように、同一アノテーション内で`@AliasFor`を使用している場合にエラーが発生：

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface RequestMapping {
    @AliasFor("path")
    String[] value() default {};
    
    @AliasFor("value")  // ローカル属性のエイリアス
    String[] path() default {};
}
```

`RuntimeHintsUtils.registerAnnotation()`が、このようなローカル属性のエイリアスに対するプロキシヒントを登録しません。

**エラー内容**:
```
Caused by: com.oracle.svm.core.jdk.UnsupportedFeatureError: 
Proxy class defined by interfaces 
[interface org.springframework.web.bind.annotation.RequestMapping, 
 interface org.springframework.core.annotation.SynthesizedAnnotation] 
not found. Generating proxy classes at runtime is not supported.
```

ネイティブイメージでは、実行時のプロキシ生成ができないため、ビルド時にすべてのプロキシを事前登録する必要があります。

## 原因

`RuntimeHintsUtils.registerAnnotation()`メソッドの実装が、`@AliasFor`の2つのパターンのうち、ローカル属性のエイリアスを考慮していませんでした：

1. **メタアノテーションへのエイリアス**（検出済み）:
   ```java
   @RequestMapping(path = "/api")
   @interface ApiMapping {
       @AliasFor(annotation = RequestMapping.class, attribute = "path")
       String value() default "";
   }
   ```

2. **ローカル属性のエイリアス**（未検出・バグ）:
   ```java
   @interface MyAnnotation {
       @AliasFor("otherName")
       String name() default "";
       
       @AliasFor("name")
       String otherName() default "";
   }
   ```

Springは`SynthesizedAnnotation`プロキシを生成してエイリアス解決を行いますが、そのプロキシヒントが登録されていませんでした。

## 対応方針

以下のコミットで修正されました：

- [718ef42](https://github.com/spring-projects/spring-framework/commit/718ef42d68acbdc9f62799d2e3762bd4d4361a04)
- [86a85f5](https://github.com/spring-projects/spring-framework/commit/86a85f558c7c319c6dbb651807dce7ebbe2e1f3e)

**実装内容**:

`RuntimeHintsUtils.registerAnnotation()`を修正し、ローカル属性のエイリアスも検出：

```java
public static void registerAnnotation(RuntimeHints hints, Class<? extends Annotation> annotation) {
    // アノテーション自体のヒント
    hints.reflection().registerType(annotation, ...);
    
    // すべての属性をチェック
    for (Method method : annotation.getDeclaredMethods()) {
        AliasFor aliasFor = method.getAnnotation(AliasFor.class);
        if (aliasFor != null) {
            // メタアノテーションへのエイリアス
            if (!aliasFor.annotation().equals(Annotation.class)) {
                registerAnnotation(hints, aliasFor.annotation());
            }
            // ローカル属性のエイリアス（新規対応）
            else {
                // SynthesizedAnnotationプロキシヒントを登録
                hints.proxies().registerJdkProxy(
                    annotation,
                    SynthesizedAnnotation.class);
            }
        }
    }
}
```

**修正のポイント**:
1. `@AliasFor`のすべてのパターンを検出
2. ローカル属性のエイリアスがある場合、プロキシヒントを登録
3. `SynthesizedAnnotation`インターフェースのプロキシ設定を追加

**メリット**:
- `@RequestMapping`などの標準アノテーションがネイティブイメージで動作
- ローカル属性エイリアスを使用するすべてのアノテーションに対応
- エラーの自動回避
