*このドキュメントは生成AI(Claude Sonnet 4.5)によって2026年1月6日に生成されました。*

## 課題概要

Spring MVCのWebコントローラー（`@RequestMapping`などのアノテーション付きメソッド）をネイティブイメージで実行できるよう、リフレクションヒントを自動的に追加する機能強化です。

**背景説明**:
- **@RequestMapping**: HTTPリクエストをコントローラーメソッドにマッピングするアノテーション（`@GetMapping`、`@PostMapping`なども含む）
- **リフレクション**: Javaの実行時にクラスやメソッドの情報を動的に取得・実行する機能
- **ネイティブイメージ**: GraalVMでJavaアプリケーションをネイティブバイナリにコンパイルしたもの
- **リフレクションヒント**: ネイティブイメージビルド時に、リフレクションで使用される要素を事前に登録する情報

**問題の詳細**:
Spring MVCは、コントローラーメソッドをリフレクションで呼び出します：

```java
@RestController
public class UserController {
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {  // リフレクションで呼び出される
        return userService.findById(id);
    }
    
    @PostMapping("/users")
    public User createUser(@RequestBody UserDto dto) {  // DTOもリフレクションで処理
        return userService.create(dto);
    }
}
```

ネイティブイメージでは、リフレクションで使用されるすべての要素を事前に登録する必要があります：
- コントローラーメソッド自体
- 戻り値の型（`User`）
- パラメータの型（`Long`、`UserDto`）
- アノテーション（`@GetMapping`、`@PathVariable`など）

これらを手動で登録するのは非常に手間がかかり、漏れが発生しやすい問題でした。

## 原因

Spring Frameworkが、コントローラーメソッドやその関連型に対するリフレクションヒントを自動的に生成する仕組みを持っていませんでした。

AOT（Ahead-Of-Time）コンパイル時に、以下の情報を収集・登録する必要がありますが、その処理が実装されていませんでした：
- `@RequestMapping`系アノテーション付きメソッド
- メソッドの戻り値型（JSON/XMLシリアライゼーション用）
- メソッドのパラメータ型（リクエストバインディング用）
- 関連するアノテーション（`@PathVariable`、`@RequestBody`など）

## 対応方針

多数のコミットで段階的に実装されました（主要なもの）：

- [c956c06](https://github.com/spring-projects/spring-framework/commit/c956c06077a2c2c210bb79c5ef72d7a4527c041d): 基本的なヒント生成
- [966e46c](https://github.com/spring-projects/spring-framework/commit/966e46c833bba197382aa2c1224c67d8576e918c): メソッド固有の処理
- [3574f3d](https://github.com/spring-projects/spring-framework/commit/3574f3d2c0ba128d967c7e9772e7ed2f32c9619a): アノテーションヒント
- [sdeleuze/spring-framework/tree/gh-28518](https://github.com/sdeleuze/spring-framework/tree/gh-28518): `webmvc-tomcat`サンプルでの動作確認

**実装内容**:

AOTプロセスでコントローラーを分析し、必要なヒントを自動生成：

```java
@RestController
public class UserController {
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
}

// ↓ AOT時に自動的に以下のヒントが生成される

RuntimeHints hints = ...;
hints.reflection()
    .registerMethod(UserController.class.getMethod("getUser", Long.class),
        ExecutableMode.INVOKE);  // メソッド呼び出しヒント
hints.reflection()
    .registerType(User.class, 
        MemberCategory.DECLARED_FIELDS);  // 戻り値型のフィールドアクセス
hints.reflection()
    .registerType(Long.class);  // パラメータ型
hints.reflection()
    .registerType(GetMapping.class);  // アノテーション
hints.resources()
    .registerPattern("org/springframework/http/mime.types");  // リソース
```

**検出される情報**:
1. **メソッドヒント**: すべての`@RequestMapping`系メソッド
2. **戻り値型ヒント**: JSONシリアライゼーション用のフィールドアクセス
3. **パラメータ型ヒント**: リクエストバインディング用
4. **アノテーションヒント**: `MergedAnnotations`がプロキシを自動処理するため登録
5. **リソースヒント**: `mime.types`などの必要なリソースファイル

**メリット**:
- Spring MVCアプリケーションがネイティブイメージで動作
- 手動ヒント登録の不要化
- ヒント漏れによる実行時エラーの削減
- `webmvc-tomcat`サンプルでの動作実証済み
