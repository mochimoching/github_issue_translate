# MissingServletRequestPartException周辺のパッケージサイクルを解決

**課題番号**: #28455

**状態**: closed | **作成者**: jhoeller | **作成日**: 2022-05-12

**ラベル**: in: web, type: regression

**URL**: https://github.com/spring-projects/spring-framework/issues/28455

**関連リンク**:
- Commits:
  - [2269c00](https://github.com/spring-projects/spring-framework/commit/2269c0063a4f56985a8903b16d922ef05a7e6b30)

## 内容

#27910 / #27948以降、`web.multipart.MissingServletRequestPartException`が`web.bind.ServletRequestBindingException`を継承するようになりましたが、残念ながら、`web.bind`パッケージがバインダー実装内で`web.multipart`に依存しているため、パッケージサイクルが発生してしまいます。

この問題の根本原因は、`MissingServletRequestPartException`が2つのかなり異なる目的を果たしていることです：`RequestPartServletServerHttpRequest`によって低レベルAPIの例外としてスローされる（これが`web.multipart`パッケージに存在する理由です）一方で、ハンドラーメソッド引数のバインディングのために`RequestParamMethodArgumentResolver`でも使用されます（この目的のためには実際には`web.bind`に存在すべきです）。適切な解決策は、バインディング目的には別の例外型を使用し、6.0からはそれだけを`ServletRequestBindingException`を継承させることです。M5でこれを再検討しましょう。

## コメント

### コメント 1 by rstoyanchev

**作成日**: 2022-05-12

元々、`MissingServletRequestPartException`は、マルチパート処理に関連する4xx対5xxの例外を区別した結果として導入されました。#13284と関連する修正56c8c69c4ce04e9d35d19e26d279ccd3b2e5a385を参照してください。それ以前は、`RequestParamMethodArgumentResolver`は基底クラスの`ServletRequestBindingException`を発生させていました。

どこで検出されたかに関わらず、欠落したパートに対して単一の例外を持つことは依然として有用だと思います。`RequestPartServletServerHttpRequest`が`web.multipart`の下にあるのは、マルチパート処理に関連しており、それが必要とされる最も低いレベルだからです。

1つの代替案は、#27948の変更を元に戻すこと、つまり、再び`ServletException`を継承させ、`ServletRequestBindingException`を継承しない理由は、より低いレベルで発生する可能性があり、異なるパッケージに存在するからだということをより明示的に文書化することです。振り返ってみると、#27910は実際の問題というよりも質問だったのではないかと思います。これは基本的に#27910の「正当な理由がない場合」という質問に答えています。
