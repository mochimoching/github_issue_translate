# ClassNameGenerator::generateClassNameの曖昧な動作

**課題番号**: #28517

**状態**: closed | **作成者**: bclozel | **作成日**: 2022-05-24

**ラベル**: in: core, type: enhancement, theme: aot

**URL**: https://github.com/spring-projects/spring-framework/issues/28517

**関連リンク**:
- Commits:
  - [63fae8c](https://github.com/spring-projects/spring-framework/commit/63fae8c5a7ea21e4ff59ee094cc4541c048e8e54)

## 内容

`ClassNameGenerator`には`generateClassName`機能の2つのバリアントがあります。1つはターゲット`Class<?>`を取り、もう1つはターゲット`String`を取ります。ここでのターゲットの概念が少し混乱していて、Javadocでもう少し説明すべきだと思います。

これらのメソッドは異なる動作もします：

```java
ClassName first = this.generator.generateClassName(java.io.InputStream.class, "bytes");
// 結果は java.io.InputStream__Bytes になります

ClassName first = this.generator.generateClassName("java.io.InputStream", "bytes");
// 結果は __.JavaIoInputStream__Bytes になります
```

動作の違いが意図されているとしても、名前とドキュメントは非常に似ています。また、`ClassNameGenerator`の一般的なユースケースは、可視性の問題を回避するために特定のパッケージにソースを生成することです。2番目のバリアントは、このケースをより困難にする可能性があります。

補足として、このクラスは現在廃止されている`@see GeneratedClassName`も参照しています。

cc @philwebb @snicoll

## コメント

### コメント 1 by philwebb

**作成日**: 2022-05-24

`String`バリアントは、リンクできる単一のクラスがない場合の生成をサポートするために追加されました。現在は`BeanRegistrationsAotContribution`でのみ使用されていると思います。ターゲットクラスがないことをより明確にするために、そのメソッドの名前を変更すべきです。

@snicollは一般的な`__`パッケージの使用について疑問に思っていたのを知っています。おそらく、生成された`BeanRegistrations`クラスを`@SpringBootApplication`クラスと同じパッケージにすることで、文字列バージョンを完全に削除できます。

`ClassNameGenerator`は削除すべきです。プロトタイプ作業中にそのクラスを削除しました。

### コメント 2 by snicoll

**作成日**: 2022-06-20

`Class<?>`ではなく`String`を取る2番目のメソッドは、4bd33cb6e0659df2cd0b9fa04feea8fd77e5a16dで削除されました。Javadocを見て、明確化できるか確認します。
